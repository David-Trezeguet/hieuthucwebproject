<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('./head'); %>
</head>
<body class="container">

<header>
    <%- include('./header'); %>
</header>

<main>
    Log In. If you already have a BookExchange profile, please log in.
    <form name="loginForm"> <!-- manually post via function -->
        <p><label>Email</label></p>
        <p><input type="email" name="email"></p>
        <p><label>Password</label></p>
        <p><input type="password" name="password"></p>

        <input type="button" name="btn_login" value="Log In">
        
        <p>Do not have account yet?</p>
        <p><input type="button" name="" value="Create account" onclick="window.location.href='/signup';"></p>

    </form>

    <script type="text/javascript">
        function login(){
          const email = document.forms.loginForm.email.value;
          const password = document.forms.loginForm.password.value;
          console.log(email, password);
          postData('/login', { email: email, password: password })
            .then(data => {
              console.log(data); // JSON data parsed by `data.json()` call
              localStorage.setItem('idmember', data[0].idmember);
              localStorage.setItem('firstname', data[0].firstname);
              localStorage.setItem('lastname', data[0].lastname);
              window.location.href = '/home?idmember=' + data[0].idmember;
            });
        }

        // async function postData(url = '', data = {}) {
        // // Default options are marked with *
        //   const response = await fetch(url, {
        //     method: 'POST', // *GET, POST, PUT, DELETE, etc.
        //     mode: 'cors', // no-cors, *cors, same-origin
        //     cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
        //     credentials: 'same-origin', // include, *same-origin, omit
        //     headers: {
        //       'Content-Type': 'application/json'
        //       // 'Content-Type': 'application/x-www-form-urlencoded',
        //     },
        //     redirect: 'follow', // manual, *follow, error
        //     referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        //     body: JSON.stringify(data) // body data type must match "Content-Type" header
        //   });
        //   return response.json(); // parses JSON response into native JavaScript objects
        // }

        document.forms.loginForm.btn_login.onclick = login;
    </script>

</main>

<footer>
    <%- include('./footer'); %>
</footer>

</body>
</html>