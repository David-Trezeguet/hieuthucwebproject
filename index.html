<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="index.js"></script>
    <title>BookExchange | Welcome to BookExchange</title>
</head>
<body>
    <!-- START thuc:login update data validation -->
    Log In. If you already have a BookExchange profile, please log in.
    <form name="loginForm" action='/login' method="POST" onsubmit="return validateForm()">    
        <p><label>Email</label></p>
        <p><input type="email" name="email" onblur="validate(this)"
              onfocus="removeValidatingNotification(this)"></p>
        <p><label>Password</label></p>
        <p><input type="password" name="password" onblur="validate(this)"
              onfocus="removeValidatingNotification(this)"></p>
          <script type="text/javascript">
              function validate(obj) {
                  removeValidatingNotification(obj);

                  if (obj.value.trim() == "") {
                    const notificationElement = document.createElement('p');
                    notificationElement.innerText = "Please enter your " + obj.name + ".";
                    notificationElement.style.color = 'red';
                    notificationElement.id = obj.name + '-validating-notification';
                    obj.parentNode.append(notificationElement);
                    return false;
                  }

                  return true;
              }

              function removeValidatingNotification(obj) {
                const x = document.getElementById(obj.name + '-validating-notification');
                if(x) x.remove();
              }

              function validateForm() {
                validate(document.forms.loginForm["email"]);
                validate(document.forms.loginForm["password"]);

                return validate(document.forms.loginForm["email"]) && validate(document.forms.loginForm["password"]);
              }
          </script>

        <input type="submit" name="" value="Log In">
        
        <p>Do not have account yet?</p>
        <p><input type="button" name="" value="Create account" onclick="window.location.href='/signup'"></p>

    </form>
    <!-- END thuc:login update data validation -->

    <!-- START thuc:signup update data validation -->
    Welcome to BookExchange!<br>
    To start your journey you need to register.
    <form name="signupForm" action="/signup" method="POST" onsubmit="return validateForm2()">
        <p><label>Name</label><input type="text" name="name" onblur="validate(this)"
              onfocus="removeValidatingNotification(this)"></p>
        <p><label>Surname</label><input type="text" name="surname"></p>
        <p><label>Email</label><input type="email" name="email" onblur="validate(this)"
              onfocus="removeValidatingNotification(this)"></p>
        <p><label>Country</label><input type="text" name="country"></p>
        <p><label>City</label><input type="text" name="city"></p>
        <p><label>Street</label><input type="text" name="street"></p>
        <p><label>Postal code</label><input type="text" name="postal code"></p>
        
        <p><label>Set up your password</label></p>
        <p><input type="password" name="password" onblur="validate(this)"
              onfocus="removeValidatingNotification(this)"></p>
        <p><label>Please re-type your password</label></p>
        <p><input type="password" name="password2" onfocus="removeValidatingNotification(this)"></p>

        <input type="submit" name="" value="Create account">
    </form>
    <script type="text/javascript">
        function validate(obj) {
            removeValidatingNotification(obj);

            if (obj.value.trim() == "") {
              const notificationElement = document.createElement('p');
              notificationElement.innerText = "Please enter your " + obj.name + ".";
              notificationElement.style.color = 'red';
              notificationElement.id = obj.name + '-validating-notification';
              obj.parentNode.append(notificationElement);
              return false;
            }

            return true;
        }

        function removeValidatingNotification(obj) {
          const x = document.getElementById(obj.name + '-validating-notification');
          if(x) x.remove();
        }

        function validatePasswordMatch(){
          const pw = document.forms.signupForm["password"];
          const pw2 = document.forms.signupForm["password2"];

          removeValidatingNotification(pw2);

          if (pw2.value != pw.value){
              const notificationElement = document.createElement('p');
              notificationElement.innerText = "Your password does not match. Please try again.";
              notificationElement.style.color = 'red';
              notificationElement.id = pw2.name + '-validating-notification';
              pw2.parentNode.append(notificationElement);
              return false;
          }

          return true;
        }

        function validateForm2() {
          validate(document.forms.signupForm["name"]);
          validate(document.forms.signupForm["email"]);
          validate(document.forms.signupForm["password"]);
          validatePasswordMatch();

          return validate(document.forms.signupForm["name"])
              && validate(document.forms.signupForm["email"])
              && validate(document.forms.signupForm["password"])
              && validatePasswordMatch();
        }
    </script>
    <!-- END thuc:signup update data validation -->

    <!-- START thuc:profile page -->
    <div class="t-profile-information">
        <div class="t-left-panel-avatar-and-name">
            <div class="t-avatar"><img src="./images/avatar.jpg"></div>
            <!-- <div class="t-full-name">{member.firstname + ' ' + member.lastname}</div> -->
            <div class="t-full-name">John Doe</div>
            <button id="edit-my-profile">Edit my profile</button>
        </div>
        <div class="t-right-panel-other-info">
            <label>Full name</label><label class="non-editable" name="profile-info-to-edit" contentEditable="false">John Doe</label><hr>
            <label>Email</label><label class="non-editable" name="profile-info-to-edit" contentEditable="false">doe.john.9600@gmail.com</label><hr>
            <label>Phone</label><label class="non-editable" name="profile-info-to-edit" contentEditable="false">+358 20 6110 200</label><hr>
            <label>Address</label><label class="non-editable" name="profile-info-to-edit" contentEditable="false">Pentti Kaiteran katu 1, 90570 Oulu</label><hr>

            <label>Credit score</label>
            <label>
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
                <style type="text/css">
                    .fa-star.checked, .fa-star-half.checked { color: orange; }
                </style>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star-half checked"></span>
            </label>
        </div>
        <style type="text/css">
            .editable {
                border: 1px solid black;
                padding: 0px 10px;
                cursor: text;
                color: red;
            }

            .non-editable {
                border: none;
                padding: none;
                cursor: default;
                color: black;
            }
        </style>
        <script type="text/javascript">
            function toggleEdit() {
                let editMyProfileButton = document.getElementById('edit-my-profile');

                if (editMyProfileButton.innerText == 'Edit my profile'){  //contentEditable == false
                    editMyProfileButton.innerText = 'Done editing';
                } else {
                    editMyProfileButton.innerText = 'Edit my profile';
                }
                
                for (let element of document.getElementsByName('profile-info-to-edit')){
                    element.onkeypress = (event) => {
                        if (event.key == 'Enter') {
                            event.preventDefault();
                        }
                    }

                     if (element.isContentEditable == false){
                        element.contentEditable = true;
                        element.classList.remove('non-editable');
                        element.classList.add('editable');
                     } else {
                        element.contentEditable = false;
                        element.classList.remove('editable');
                        element.classList.add('non-editable');
                     }
                }
            }

            document.getElementById('edit-my-profile').onclick=toggleEdit;
        </script>
    </div>


    <h2>My books</h2> <!-- guest view: John Doe's books -->
    <div class="t-my-books">
        <div class="t-book-listing">
            <img src="images/book-cover.jpg">
            <img src="images/book-cover.jpg">
            <img src="images/book-cover.jpg">
            <img src="images/book-cover.jpg">
        </div>
        <div class="t-pagination">
            <button id="btn_prev">Previous</button>
            <span id="page_span">1</span>
            <button id="btn_next">Next</button>

            <script type="text/javascript">
                var current_page = 1;
                var records_per_page = 4;

                var objJson = [
                    { Book: "Book 1"},
                    { Book: "Book 2"},
                    { Book: "Book 3"},
                    { Book: "Book 4"},
                    { Book: "Book 5"},
                    { Book: "Book 6"},
                    { Book: "Book 7"},
                    { Book: "Book 8"},
                    { Book: "Book 9"},
                    { Book: "Book 10"}
                ]; // Can be obtained from another source, such as your objJson variable

                function prevPage()
                {
                    if (current_page > 1) {
                        current_page--;
                        changePage(current_page);
                    }
                }

                function nextPage()
                {
                    if (current_page < numPages()) {
                        current_page++;
                        changePage(current_page);
                    }
                }
                    
                function changePage(page)
                {
                    var btn_next = document.getElementById("btn_next");
                    var btn_prev = document.getElementById("btn_prev");
                    var listing_table = document.getElementsByClassName("t-book-listing")[0];
                    var page_span = document.getElementById("page_span");

                    btn_next.onclick = nextPage;
                    btn_prev.onclick = prevPage;
                 
                    // Validate page
                    if (page < 1) page = 1;
                    if (page > numPages()) page = numPages();

                    listing_table.innerHTML = "";

                    for (var i = (page-1) * records_per_page; i < (page * records_per_page); i++) {
                        if (i >= objJson.length) break;  //last page may not have enough items like previous pages
                        listing_table.innerHTML += objJson[i].Book + "<br>";
                    }
                    page_span.innerHTML = 'Current page: ' + page;

                    if (page == 1) {
                        btn_prev.style.visibility = "hidden";
                    } else {
                        btn_prev.style.visibility = "visible";
                    }

                    if (page == numPages()) {
                        btn_next.style.visibility = "hidden";
                    } else {
                        btn_next.style.visibility = "visible";
                    }
                }

                function numPages()
                {
                    return Math.ceil(objJson.length / records_per_page);
                }

                window.onload = function() {
                    changePage(1);
                };


            </script>
        </div>
    </div>

    <h2>About me</h2>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum condimentum in est sed sollicitudin. Pellentesque venenatis malesuada sapien, a tempor ipsum. Proin cursus ante vitae purus tempor cursus. Vivamus sit amet varius ex, eleifend sodales lectus. Etiam convallis dapibus ornare. Nullam nec dolor a nisi accumsan dapibus. Proin sagittis sem nulla, id tempus diam mollis non. Mauris in massa id velit sagittis mattis non id mauris. Etiam leo neque, sollicitudin sed libero sit amet, consectetur ullamcorper urna. Mauris eros enim, pharetra et elit eu, placerat blandit ipsum. Vestibulum iaculis purus ut ipsum accumsan commodo. Mauris tristique laoreet elit non scelerisque. Maecenas nec accumsan nibh, in tincidunt nunc. Aenean lorem lectus, semper eu ipsum et, posuere lobortis ligula. Nunc justo nibh, euismod a tincidunt et, tincidunt nec enim. Fusce id tellus vitae ipsum mollis malesuada</p>

    <h2>Latest Reviews</h2>
    <table>
        <tr>
            <td>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star checked"></span>
            </td>
            <td>
                Excellent. He is a true book lover. The book is carefully used
            </td>
            <td>
                <span class="fa fa-user"></span>
                Zoralth
            </td>
        </tr>
        <tr>
            <td>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star"></span>
            </td>
            <td>
                There was a little misunderstanding at first. Then everything went well
            </td>
            <td>
                <span class="fa fa-user"></span>
                Billy the Kid
            </td>
        </tr>
    </table>
    <p><a href="/review">All Reviews</a></p>
    
    <!-- END thuc:profile page -->
</body>
</html>